# Cloudflare R2セットアップガイド

このドキュメントは、CloudLaunchアプリケーションでCloudflare R2ストレージを利用するための設定手順を説明します。

## 概要

CloudLaunchは、ゲームのセーブデータや設定ファイルをクラウドに同期するために、S3互換のオブジェクトストレージをサポートしています。Cloudflare R2は、S3互換APIを提供する安価で高性能なストレージサービスであり、本アプリケーションの推奨ストレージの一つです。

このガイドに従うことで、Cloudflare R2バケットを作成し、アプリケーションに必要な認証情報を取得できます。

## 前提条件

- Cloudflareアカウントを所有していること。
- Cloudflareダッシュボードにアクセスできること。

## 設定手順

### 1. R2の有効化

1.  Cloudflareダッシュボードにログインします。
2.  左側のメニューから **[R2]** を選択します。
3.  初回利用時は、R2の利用を開始するために支払い情報の登録を求められる場合があります。指示に従って設定を完了してください。

### 2. R2バケットの作成

1.  R2の管理画面で、**[バケットを作成する]** をクリックします。
2.  **バケット名** を入力します。
    - 例: `cloudlaunch-save-data`
    - **注意**: バケット名はグローバルに一意である必要はありませんが、アカウント内で一意である必要があります。
3.  **ロケーション** を選択します。
    - ユーザーの地理的な位置に近いリージョンを選択すると、パフォーマンスが向上する場合があります。
    - 「自動」を選択すると、最適なロケーションが自動で選択されます。
4.  **[バケットを作成する]** をクリックして、作成を完了します。

### 3. S3互換APIトークンの作成

アプリケーションがR2バケットにアクセスするためには、S3互換のAPIトークンが必要です。

1.  R2の管理画面に戻り、右上の **[R2 APIトークンを管理]** をクリックします。
2.  **[APIトークンを作成]** をクリックします。
3.  **トークン名** を入力します。
    - 例: `cloudlaunch-access-token`
4.  **権限** を選択します。
    - アプリケーションの全機能（アップロード、ダウンロード、削除）を利用するには、**[管理者読み取りと書き込み]** を選択することを推奨します。
    - より厳密な権限管理を行いたい場合は、**[オブジェクトの読み取りと書き込み]** を選択してください。
5.  **TTL（オプション）** を設定します。
    - トークンの有効期限を設定できます。セキュリティ要件に応じて設定してください。
6.  **[APIトークンを作成]** をクリックします。

### 4. 認証情報の取得と保管

トークンを作成すると、以下の重要な情報が表示されます。**この情報は一度しか表示されないため、必ず安全な場所にコピーして保管してください。**

- **アクセスキーID** (`Access Key ID`)
- **シークレットアクセスキー** (`Secret Access Key`)

また、アプリケーションの設定には **S3 APIエンドポイント** も必要です。

1.  R2のバケット管理画面に戻り、対象のバケットをクリックします。
2.  **[設定]** タブを開きます。
3.  **[S3互換API]** のセクションにある **[S3 APIエンドポイント]** をコピーします。
    - 形式: `https://<ACCOUNT_ID>.r2.cloudflarestorage.com`

### 5. CloudLaunchアプリケーションへの設定

取得した以下の4つの情報を、CloudLaunchアプリケーションの認証情報設定画面に入力します。

1.  **S3 APIエンドポイント**: `https://<ACCOUNT_ID>.r2.cloudflarestorage.com`
2.  **バケット名**: 手順2で作成したバケット名 (例: `cloudlaunch-save-data`)
3.  **アクセスキーID**: 手順4で取得したアクセスキーID
4.  **シークレットアクセスキー**: 手順4で取得したシークレットアクセスキー

これで、Cloudflare R2を利用するためのすべての設定が完了しました。

## トラブルシューティング

- **認証エラーが発生する場合**:
  - 入力した各情報（エンドポイント、バケット名、アクセスキー）が正しいか再確認してください。
  - APIトークンの権限が不足していないか確認してください。
- **ファイルのアップロード/ダウンロードに失敗する場合**:
  - CloudflareのステータスページでR2の障害情報を確認してください。
  - バケットのCORSポリシーが正しく設定されているか確認してください（通常はデフォルトで問題ありません）。

以上で、Cloudflare R2のセットアップは完了です。

